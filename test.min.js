var canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d"),chkText=document.getElementById("PText"),chkData=document.getElementById("DefData"),chkloop=document.getElementById("ChkLoop"),legend1=document.getElementById("legend1"),legend2=document.getElementById("legend2"),dateupdate=document.getElementById("DateUpdate"),but1=document.getElementById("TestPercent"),but2=document.getElementById("TestProcess"),but3=document.getElementById("TestBlinkStatus"),but4=document.getElementById("TestNumberColumn"),but5=document.getElementById("TestDiagramStove"),but6=document.getElementById("TestPost"),text=document.getElementById("TestDiv"),diagramStove=new Diagram(0,0,canvas.width,canvas.height);diagramStove.BuildDefault();function Resize(){window.innerWidth>window.innerHeight?(canvas.style.margin="10px 0px 10px 10px",canvas.width=window.innerWidth-20,canvas.height=window.innerHeight-legend1.offsetHeight-legend2.offsetHeight-buttons.offsetHeight-60,diagramStove.Rotate=0,diagramStove.RectParam(0,0,canvas.width,canvas.height)):(canvas.style.margin="10px 0px 27px 10px",canvas.width=window.innerWidth-37,canvas.height=(window.innerHeight-70)*Math.floor(diagramStove.ProcessCount()/13),diagramStove.Rotate=1,diagramStove.RectParam(0,0,canvas.height,canvas.width));ctx=canvas.getContext("2d");diagramStove.Print(ctx);chkText.checked&&diagramStove.PrintText(ctx)}window.addEventListener("load",Resize,!1);window.addEventListener("resize",Resize,!1);but1.onclick=function(){ctx.clearRect(0,0,canvas.width,canvas.height);for(var b=0;10+35*(b+1)<canvas.width;b++)for(var a=0;105*a+60<canvas.height;a++){var c=new PercentColumn(5+35*b,5+105*a,30,10+105*(a+1)<=canvas.height?100:canvas.height-10-105*a,Math.floor(101*Math.random()),chkData.checked?"#222":getRColor());c.Print(ctx);chkText.checked&&c.PrintText(ctx)}};but2.onclick=function(){ctx.clearRect(0,0,canvas.width,canvas.height);for(var b=0;10+35*(b+1)<canvas.width;b++)for(var a=0;10+205*(a+1)<canvas.height;a++){var c=new ProcessColumn(5+35*b,5+205*a,30,10+205*(a+1)<=canvas.height?200:canvas.height-30-200*a);if(chkData.checked)c.BuildDefault();else for(var d=0;d<Math.floor(9*Math.random()+1);d++)c.AddRStat(getRColor(),Math.floor(100*Math.random()));c.Status(Math.floor(11*Math.random()+1));c.Percent(Math.floor(101*Math.random()));c.Print(ctx);chkText.checked&&c.PrintText(ctx)}};but3.onclick=function(){ctx.clearRect(0,0,canvas.width,canvas.height);for(var b=0;10+35*(b+1)<canvas.width;b++)for(var a=0;10+20*(a+1)<canvas.height;a++){var c=new BlinkStatus(5+35*b,5+20*a,30,15);if(chkData.checked)c.BuildDefault();else for(var d=0;3>d;d++)c.AddStatus(getRColor());c.Status(Math.floor(4*Math.random()));c.Print(ctx);chkText.checked&&c.PrintText(ctx)}};but4.onclick=function(){ctx.clearRect(0,0,canvas.width,canvas.height);for(var b=0;10+35*(b+1)<canvas.width;b++)for(var a=0;10+25*(a+1)<canvas.height;a++){var c=new NumberColumn(5+35*b,5+25*a,30,20,Math.floor(100*Math.random()));c.Prostoy(Math.floor(2*Math.random()));c.Print(ctx)}};but5.onclick=function(){ctx.clearRect(0,0,canvas.width,canvas.height);var b=new Diagram(0,0,canvas.width,canvas.height);if(chkData.checked){b.BuildDefault();for(var a=0;a<b.ProcessCount();a++)b.ChangeStatProc(a,Math.floor(11*Math.random()+1),Math.floor(101*Math.random())),b.ChangeStatBlink(a,Math.floor(4*Math.random())),b.ChangeStatNumb(a,Math.floor(2*Math.random()))}else{var c=Math.floor(100*Math.random());for(a=0;a<c;a++){for(var d=new ProcessColumn(0,0,0,0),e=0;e<Math.floor(9*Math.random()+1);e++)d.AddRStat(getRColor(),Math.floor(100*Math.random()));d.Status(Math.floor(11*Math.random()+1));d.Percent(Math.floor(101*Math.random()));e=new BlinkStatus(0,0,0,0);for(var f=0;3>f;f++)e.AddStatus(getRColor());e.Status(Math.floor(4*Math.random()));f=new NumberColumn(0,0,0,0,a+1);f.Prostoy(Math.floor(2*Math.random()));b.AddStove(d,e,f)}}b.Print(ctx);chkText.checked&&b.PrintText(ctx)};but6.onclick=function(){var b=new XMLHttpRequest;b.open("POST","getinfo",!0);b.send();b.onreadystatechange=function(){if(4==b.readyState)if(200!=b.status)alert(b.status+": "+b.statusText);else{var a=JSON.parse(b.responseText);ctx.clearRect(0,0,canvas.width,canvas.height);for(var c=1;c<=diagramStove.ProcessCount();c++)diagramStove.ChangeStatBlink(c,a[c].Bstatus),diagramStove.ChangeStatProc(c,a[c].Pstatus),diagramStove.ChangeStartDate(c,ConvDate(a[c].Start)),diagramStove.ChangeEndDate(c,ConvDate(a[c].EndTeor));a=ConvDate(a[0].DateNow);dateupdate.innerHTML=a.getFullYear()+"."+FNL(a.getMonth()+1,2)+"."+FNL(a.getDate(),2)+"  "+FNL(a.getHours(),2)+":"+FNL(a.getMinutes(),2)+":"+FNL(a.getSeconds(),2);chkloop.checked?(setTimeout(but6.onclick,6E4),but6.disabled=!0):but6.disabled=!1;PrintCycle()}}};function PrintCycle(){diagramStove.Print(ctx);chkText.checked&&diagramStove.PrintText(ctx);but6.disabled&&setTimeout(PrintCycle,1E3)}function FNL(b,a){for(var c=""+b;c.length<a;)c="0"+c;return c}function ConvDate(b){b=b.split(".")[0].split("T");var a=b[0].split("-");b=b[1].split(":");return new Date(a[0],parseInt(a[1])-1,a[2],b[0],b[1],b[2])}function getRColor(){for(var b="#",a=0;6>a;a++)b+="0123456789ABCDEF"[Math.floor(16*Math.random())];return b};