var dateNowHTML=document.getElementById("DateTimeNow"),dateUpdateHTML=document.getElementById("DateUpdate"),canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d"),diagramStove=new Diagram(0,0,canvas.width,canvas.height),update_button=document.getElementById("Update_Button");function PrintDateNow(){var a=new Date;dateNowHTML.innerHTML=a.getFullYear()+"."+FNL(a.getMonth()+1,2)+"."+FNL(a.getDate(),2)+"  "+FNL(a.getHours(),2)+":"+FNL(a.getMinutes(),2)+":"+FNL(a.getSeconds(),2);setTimeout(PrintDateNow,1E3)}function FNL(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c}PrintDateNow();function Resize(){window.innerWidth>window.innerHeight?(canvas.height=window.innerHeight-20-document.getElementById("First_Head").offsetHeight-document.getElementById("Second_Head").offsetHeight-document.getElementById("Third_Head").offsetHeight,canvas.width=document.getElementById("Canvas_Body").offsetWidth,diagramStove.Rotate=0,diagramStove.RectParam(0,0,canvas.width,canvas.height)):(canvas.height=25*diagramStove.ProcessCount(),canvas.width=document.getElementById("Canvas_Body").offsetWidth,diagramStove.Rotate=1,diagramStove.RectParam(0,0,canvas.height,canvas.width));ctx=canvas.getContext("2d");diagramStove.Print(ctx)}window.addEventListener("load",Resize,!1);window.addEventListener("resize",Resize,!1);diagramStove.BuildDefault();function UpdateStatus(){var a=new XMLHttpRequest;a.open("POST","getinfo",!0);a.send();a.onreadystatechange=function(){if(4==a.readyState)if(200!=a.status)document.getElementById("Error_Message").innerHTML="\u041d\u0435 \u0443\u0434\u0430\u0435\u0442\u0441\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435",$("#Error_Border").show(),$("#Update_Button").show();else{$("#Error_Border").hide();var b=JSON.parse(a.responseText);ctx.clearRect(0,0,canvas.width,canvas.height);for(var c=1;c<=diagramStove.ProcessCount();c++)diagramStove.ChangeStatBlink(c,b[c].Bstatus),diagramStove.ChangeStatProc(c,b[c].Pstatus),diagramStove.ChangeStartDate(c,ConvDate(b[c].Start)),diagramStove.ChangeEndDate(c,ConvDate(b[c].EndTeor));b=ConvDate(b[0].DateNow);dateUpdateHTML.innerHTML=b.getFullYear()+"."+FNL(b.getMonth()+1,2)+"."+FNL(b.getDate(),2)+"  "+FNL(b.getHours(),2)+":"+FNL(b.getMinutes(),2)+":"+FNL(b.getSeconds(),2);6E4<Math.abs(b-new Date)?(document.getElementById("Error_Message").innerHTML="\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u043c \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c "+Math.floor(Math.abs(b-new Date)/1E3)+" \u0441\u0435\u043a",$("#Error_Border").show(),$("#Update_Button").hide()):$("#Error_Border").hide();setTimeout(UpdateStatus,6E4);diagramStove.Print(ctx)}}}UpdateStatus();function PrintCycle(){diagramStove.Print(ctx);setTimeout(PrintCycle,1E3)}PrintCycle();function ConvDate(a){a=a.split(".")[0].split("T");var b=a[0].split("-");a=a[1].split(":");return new Date(b[0],parseInt(b[1])-1,b[2],a[0],a[1],a[2])}update_button.onclick=function(){UpdateStatus()};